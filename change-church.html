<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <link rel="stylesheet" href="css/bootstrap-reboot.min.css">
    <link rel="stylesheet" href="css/bootstrap-grid.min.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/select2.min.css">
    <link rel="stylesheet" href="css/main.css">

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="img/vlogo.PNG" sizes="32x32">
    <link rel="apple-touch-icon" href="img/vlogo.PNG">

    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="Dmitry Volkov">
    <title>Virtual Church</title>

</head>

<body>
    <!-- header -->
    <header class="header">
        <div class="header__content">
            <div class="header__logo">

            </div>


            <div class="header__actions">


                <div class="header__action header__action--profile">
                    <a class="header__profile-btn " href="#" role="button" id="dropdownMenuProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">

                        <div>
                            <p>Admin Login</p>
                        </div>
                        <svg xmlns="" viewBox="0 0 24 24"><path d="M17,9.17a1,1,0,0,0-1.41,0L12,12.71,8.46,9.17a1,1,0,0,0-1.41,0,1,1,0,0,0,0,1.42l4.24,4.24a1,1,0,0,0,1.42,0L17,10.59A1,1,0,0,0,17,9.17Z"></path></svg>
                    </a>

                    <ul class="dropdown-menu header__profile-menu" aria-labelledby="dropdownMenuProfile">


                        <li>
                            <a href="https://adm.cevirtualchurch.org/admin-login" target="_blank"><span>Login</span></a>
                        </li>
                    </ul>
                </div>
            </div>

            <button class="header__btn" type="button">
				<span></span>
				<span></span>
				<span></span>
			</button>
        </div>
    </header>
    <!-- end header -->

    <!-- main content -->
    <main class="main">
        <div class="container">
            <div class="row row--grid">
                <!-- breadcrumb -->

                <!-- end breadcrumb -->

                <!-- sign in -->
                <div class="col-12">
                    <div class="sign">
                        <div class="sign__content">
                            <!-- authorization form -->
                            <div action="#" class="sign__form">
                                <a class="sign__logo">
                                    <img src="img/vlogo.PNG" alt="">
                                </a>

                                <div class="sign__group">
                                    <input type="text" class="sign__input" id="full_name" name="email" placeholder="Your email here.." disabled>
                                </div>

                                <div class="sign__group">
                                    <input type="email" class="sign__input" id="email" name="email" placeholder="Your email here.." disabled>
                                </div>


                                <div id="zonallist">

                                </div>

                                <div id="churcheslist">

                                </div>
                                <input type="hidden" id="share_code" value="">

                                <div class="col-lg-12 col-md-12 col-12">
                                    <div class="check-box-wrap">
                                        <div class="input-box">
                                            <input type="checkbox" id="fruit4" name="fruit-4" value="Strawberry" required>
                                            <label for="fruit4"> Are you sure you want to change church?</label>
                                        </div>
                                    </div>
                                </div>

                                <button class="sign__btn" type="submit" id="reg_btn">Submit</button>
                            </div>




                        </div>
                        <!-- end authorization form -->
                    </div>
                </div>
            </div>
            <!-- end sign in -->
        </div>
        </div>
    </main>
    <!-- end main content -->

    <!-- footer -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-106770506-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-106770506-2');
    </script>

    <!-- end modal wallet -->

    <!-- JS -->
    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/select2.min.js"></script>
    <script src="js/smooth-scrollbar.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/three.min.js"></script>
    <script src="js/vanta.waves.min.js"></script>
    <script src="js/main.js"></script>

    <script>
        $(".reveal").on('click', function() {
            var $pwd = $(".pwd");
            if ($pwd.attr('type') === 'text') {
                $pwd.attr('type', 'password');
            } else {
                $pwd.attr('type', 'text');
            }
        });
        $(".reveal2").on('click', function() {
            var $pwd = $(".pwdr");
            if ($pwd.attr('type') === 'text') {
                $pwd.attr('type', 'password');
            } else {
                $pwd.attr('type', 'text');
            }
        });
    </script>

    <script>
        // NProgress.start();

        var userData = JSON.parse(localStorage.getItem('authuser'));


        $("#full_name").attr("value", userData.user.userDetails.firstName + " " + userData.user.userDetails.lastName)
        $("#email").attr("value", userData.user.userDetails.emailAddress)



        if (userData == null && userData == "") {

            window.location.href = "/login.html"
        }

        // var email,share_code,zone,churches_div = "";

        $('#reg_btn').click(function(e) {

            e.preventDefault();

            var email = document.getElementById("email").value;
            var share_code = document.getElementById("share_code").value;
            var zone = document.getElementById("zones_div").value;
            var churches_div = document.getElementById("churches_div").value;


            //  alert(share_code);


            if (zone != "" && zone != null && share_code != "" && share_code != null && churches_div != "" && churches_div != null) {

                if (document.getElementById("fruit4").checked) {


                    $("#reg_btn").html("<i class='fa fa-spinner fa-spin'></i>... registering ...")

                    var formData = {


                        'userID': userData.user.userDetails.userID,
                        'churchID': share_code,
                    };

                    //alert("I got here");


                    $.ajax({
                        type: 'POST', // define the type of HTTP verb we want to use (POST for our form)
                        url: 'https://api.cevirtualchurch.org/auth/changechurch', // the url where we want to POST
                        data: formData,
                        dataType: 'json', // what type of data do we expect back from the server
                        encode: true
                    })

                    //
                    // using the done promise callback
                    .done(function(data) {

                        console.log(data.data);


                        if (data.status) {



                            localStorage.removeItem('authuser');
                            location.href = "/login.html?msg=Church Change was Successful";

                            //reset form


                        } else {

                            // alert("false")
                            //NProgress.done();

                            $("#message_div").notify(data.message, {
                                className: 'error',
                                autoHide: false,
                            });
                            $("#reg_btn").html("Submit")
                        }

                        // here we will handle errors and validation messages
                    });

                } else {
                    $("#message_div").notify("All fields are required", {
                        className: 'error',
                        autoHide: true,
                    });
                }
            } else {

                $("#message_div").notify("Please check the confirmation box", {
                    className: 'error',
                    autoHide: true,
                });
                $("#reg_btn").html("Submit")

            }
        })
    </script>




    <script>
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };


        var msg = getUrlParameter('_inv');

        //alert(msg)

        if (msg == "" || msg == null) {


            $("#zonallist").html("<div align='center'><i class='fa fa-spinner fa-spin'></i>  ... loading zones ...</div>")

            $.ajax({
                type: 'POST', // define the type of HTTP verb we want to use (POST for our form)
                url: 'https://api.cevirtualchurch.org/zone/index', // the url where we want to POST
                dataType: 'json', // what type of data do we expect back from the server
                encode: true
            })

            //
            // using the done promise callback
            .done(function(data) {

                console.log(data.data);
                // alert("I dididid")
                // log data to the console so we can see
                // console.log("I got here too just now");
                //
                //                    //if number is on kingschat then process
                if (data.status) {
                    // alert("true")

                    //   NProgress.done();

                    var obj = "";

                    obj += "<option value=''>Please Select your Zone</option>";

                    for (var i = 0; i < data.data.zones.length; i++) {
                        obj += "<option value='" + data.data.zones[i].zoneID + "'>" + data.data.zones[i].name + "</option >";
                    }

                    var final = '<div class="sign__input" style="margin-bottom: 15px;"> <label ' +
                        'for="country">Select your Zone</label><select onchange="loadChurchZone()" class="sign__group" required ' +
                        'id="zones_div" required>' + obj + '</select></div>'

                    $("#zonallist").html(final);


                    //localStorage.setItem('authuser',JSON.stringify(datar));

                    // location.href="/video"

                    //reset form


                } else {

                    //alert("false")
                    NProgress.done();

                    $("#message_div").notify(data.message, {
                        className: 'error',
                        autoHide: false,
                    });
                }

                // here we will handle errors and validation messages
            });

        } else {
            $("#share_code").attr("value", msg);
        }
    </script>

    <script>
        function loadChurchZone() {

            var zoneID = $("#zones_div").val();

            $("#churcheslist").html("<div align='center'><i class='fa fa-spinner fa-spin'></i> <br /> ... loading " +
                "churches" +
                " ...");


            if (zoneID != "") {

                var formData = {

                    'zoneID': zoneID,
                };

                $.ajax({
                    type: 'POST', // define the type of HTTP verb we want to use (POST for our form)
                    url: 'https://api.cevirtualchurch.org/zone/churches', // the url where we want to POST
                    data: formData,
                    dataType: 'json', // what type of data do we expect back from the server
                    encode: true
                })

                //
                // using the done promise callback
                .done(function(data) {

                    if (data.status) {

                        var obj = "";

                        obj += "<option value=''>Please Select your Church</option>";

                        for (var i = 0; i < data.data.churches.length; i++) {
                            obj += "<option value='" + data.data.churches[i].churchID + "'>" + data.data.churches[i].name + "</option >";
                        }

                        var final = '<div class="col-lg-12 col-md-12 col-12" style="margin-bottom: 15px;"> <label ' +
                            'for="country">Select your Church</label><select onchange="selectChurchCode()" ' +
                            'class="form-control" required ' +
                            'id="churches_div">' + obj + '</select></div>';


                        $("#churcheslist").html(final);


                    }
                });
            } else {
                $.notify("All fields are required", {
                    className: 'error',
                    autoHide: false,
                });
            }


        }


        function selectChurchCode() {

            $("#share_code").attr("value", $("#churches_div").val());

        }
    </script>





</body>

</html>